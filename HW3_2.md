HW3
================
Shayne Estill (ske2118)

The “ny_noaa” dataset has 2595176 rows and 7 columns. From the NY NOAA
information page, The resulting R dataset ny_noaa contains variables:

id: Weather station ID date: Date of observation prcp: Precipitation
(tenths of mm) snow: Snowfall (mm) snwd: Snow depth (mm) tmax: Maximum
temperature (tenths of degrees C) tmin: Minimum temperature (tenths of
degrees C)

The variable types include id(chr), date(date), prcp(int), snow(int),
snwd(int), tmax(chr), and tmin(chr).

There is a significant amount of missing data. There are 145838 missing
precipitation values, 381221 missing snow values, 591786 missing snow
depth values, 1134358 missing max temperature values, 1134420 missing
min temperature values, 0 missing date values, 0 missing ID values

\#Do some data cleaning. Create separate variables for year, month, and
day.

I also changed the new variables for year, month, and day to character.

\###Ensure observations for temperature, precipitation, and snowfall are
given in reasonable units.

The max tmax value is 99 . The min tmin value is -1. This seems
unreasonable for Celsius measures.

The max precipitation value is 22860. This seems unreasonable for tenths
of a mm.

The max snowfall value is 10160. These values don’t make sense. We
should convert these variables from character and int to double.

``` r
ny_noaa_cleaned <-ny_noaa_cleaned |>
  mutate(
    tmax = as.double(tmax, digits = 2),
    tmin = as.double(tmin, digits = 2),
    snow = as.double(snow, digits = 2),
    snwd = as.double(snow, digits = 2)
  )
```

``` r
ny_noaa_cleaned <- ny_noaa_cleaned |>
  mutate(
    tmax = tmax / 10,
    tmin = tmin / 10
  )
```

The max precipitation value is 22860 The max tmax value is 60 The min
tmin value is -59.4

For snowfall, what are the most commonly observed values? Why?

``` r
ny_noaa_cleaned |>
  ggplot(aes(x = snow)) + 
  geom_histogram() 
```

    ## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.

    ## Warning: Removed 381221 rows containing non-finite outside the scale range
    ## (`stat_bin()`).

![](HW3_2_files/figure-gfm/unnamed-chunk-5-1.png)<!-- -->

``` r
ny_noaa_cleaned |> 
  group_by(snow) |> 
  summarize(count = n()) |> 
  arrange(desc(count))
```

    ## # A tibble: 282 × 2
    ##     snow   count
    ##    <dbl>   <int>
    ##  1     0 2008508
    ##  2    NA  381221
    ##  3    25   31022
    ##  4    13   23095
    ##  5    51   18274
    ##  6    76   10173
    ##  7     8    9962
    ##  8     5    9748
    ##  9    38    9197
    ## 10     3    8790
    ## # ℹ 272 more rows

From the histogram and output, the most commonly observed snowfall
values are zero, NA, 25 and 13. This is because the majority of the
year, there is no snowfall in New York.

Make a two-panel plot showing the average max temperature in January and
in July in each station across years. Is there any observable /
interpretable structure? Any outliers?

The min year is 1981. The max year is 2010.

``` r
avg_maxtemp <- ny_noaa_cleaned |>
  filter(month == 1| month == 7 ) |>
  group_by(id, month, year) |>
  summarize(avg_max_temp = mean(tmax, na.rm = TRUE))
```

    ## `summarise()` has grouped output by 'id', 'month'. You can override using the
    ## `.groups` argument.

``` r
avg_maxtemp |>
  ggplot(aes(x = year, y = avg_max_temp)) + 
  geom_point(aes(color = month)) + 
  geom_smooth(se = FALSE) +
  facet_grid(. ~ month)
```

    ## `geom_smooth()` using method = 'loess' and formula = 'y ~ x'

    ## Warning: Removed 5970 rows containing non-finite outside the scale range
    ## (`stat_smooth()`).

    ## Warning: Removed 5970 rows containing missing values or values outside the scale range
    ## (`geom_point()`).

![](HW3_2_files/figure-gfm/unnamed-chunk-6-1.png)<!-- -->

The average max temperature in January is much lower than the average
max temperature in July across all years. There does not appear to be
too much of an outlier.

Make a two-panel plot showing (i) tmax vs tmin for the full dataset
(note that a scatterplot may not be the best option). Make a plot
showing the distribution of snowfall values greater than 0 and less than
100 separately by year.

``` r
tmax_tmin = 
  ny_noaa_cleaned |>
ggplot(aes(x = tmin, y = tmax)) + 
  geom_hex() 

snowfall_dist = 
  ny_noaa_cleaned |>
  filter(snow < 100, snow > 0) |>
  ggplot(aes(x = snow, y = as.factor(year))) + 
  geom_density_ridges(scale = 0.5)

tmax_tmin + snowfall_dist
```

    ## Warning: Removed 1136276 rows containing non-finite outside the scale range
    ## (`stat_binhex()`).

    ## Picking joint bandwidth of 3.76

![](HW3_2_files/figure-gfm/unnamed-chunk-7-1.png)<!-- -->

\###Problem 2###

Load, tidy, merge, and otherwise organize the data sets. Your final
dataset should include all originally observed variables; exclude
participants less than 21 years of age, and those with missing
demographic data; and encode data with reasonable variable classes
(i.e. not numeric, and using factors with the ordering of tables and
plots in mind).

``` r
demographic_df = read_csv(file = "./HW3_2_files/nhanes_covar.csv",   
  skip = 4) |>
janitor::clean_names() |>
    filter(age > 20) |>
    drop_na() |>
    mutate(
      seqn = factor(seqn),
      sex = factor(sex),
      education = factor(education)
    )
```

    ## Rows: 250 Columns: 5
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (5): SEQN, sex, age, BMI, education
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
accel_df = read_csv(file = "./HW3_2_files/nhanes_accel.csv") |>
  janitor::clean_names() |>
  drop_na() |>
  mutate(
    seqn = factor(seqn)
  )
```

    ## Rows: 250 Columns: 1441
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (1441): SEQN, min1, min2, min3, min4, min5, min6, min7, min8, min9, min1...
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
accel_tidy_df = 
  pivot_longer(
    accel_df,
    min1:min1440,
    names_to = "obs",
    values_to = "min"
  )
  
merged_df = 
  left_join(
    accel_tidy_df,
    demographic_df,
    by = NULL,
    copy = FALSE
  )
```

    ## Joining with `by = join_by(seqn)`

Produce a reader-friendly table for the number of men and women in each
education category, and create a visualization of the age distributions
for men and women in each education category. Comment on these items.

``` r
counts_df <-
merged_df |>
  group_by(education, sex) |>
  count()

pivot_wider(
  counts_df, 
  names_from = "sex", 
  values_from = n)
```

    ## # A tibble: 4 × 4
    ## # Groups:   education [4]
    ##   education   `1`   `2`  `NA`
    ##   <fct>     <int> <int> <int>
    ## 1 1         38880 40320    NA
    ## 2 2         50400 33120    NA
    ## 3 3         80640 84960    NA
    ## 4 <NA>         NA    NA 31680

``` r
knitr::kable(counts_df)
```

| education | sex |     n |
|:----------|:----|------:|
| 1         | 1   | 38880 |
| 1         | 2   | 40320 |
| 2         | 1   | 50400 |
| 2         | 2   | 33120 |
| 3         | 1   | 80640 |
| 3         | 2   | 84960 |
| NA        | NA  | 31680 |

Traditional analyses of accelerometer data focus on the total activity
over the day. Using your tidied dataset, aggregate across minutes to
create a total activity variable for each participant. Plot these total
activities (y-axis) against age (x-axis); your plot should compare men
to women and have separate panels for each education level. Include a
trend line or a smooth to illustrate differences. Comment on your plot.

Accelerometer data allows the inspection activity over the course of the
day. Make a three-panel plot that shows the 24-hour activity time
courses for each education level and use color to indicate sex. Describe
in words any patterns or conclusions you can make based on this graph;
including smooth trends may help identify differences.

\###Problem 3###
